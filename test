#!/bin/sh

#############################
# Ubuntu RootFS Installer   #
#############################

ROOTFS_DIR=/home/container
UBUNTU_VERSION="20.04"  # B·∫°n c√≥ th·ªÉ ƒë·ªïi sang 22.04 n·∫øu th√≠ch

ARCH=$(uname -m)
if [ "$ARCH" = "x86_64" ]; then
  ARCH_ALT=amd64
  PROOT_URL="https://github.com/proot-me/proot/releases/download/v5.3.0/proot-v5.3.0-x86_64-static"
elif [ "$ARCH" = "aarch64" ]; then
  ARCH_ALT=arm64
  PROOT_URL="https://github.com/proot-me/proot/releases/download/v5.3.0/proot-v5.3.0-aarch64-static"
else
  echo "‚ùå Unsupported architecture: $ARCH"
  exit 1
fi

# T·∫°o th∆∞ m·ª•c n·∫øu ch∆∞a c√≥
mkdir -p $ROOTFS_DIR/usr/local/bin

# B∆∞·ªõc 1: T·∫£i Ubuntu rootfs n·∫øu ch∆∞a c√≥
if [ ! -e $ROOTFS_DIR/.installed ]; then
    echo "[+] ƒêang t·∫£i Ubuntu $UBUNTU_VERSION rootfs cho $ARCH_ALT..."
    curl -Lo /tmp/ubuntu-rootfs.tar.gz \
    "http://cdimage.ubuntu.com/ubuntu-base/releases/${UBUNTU_VERSION}/release/ubuntu-base-${UBUNTU_VERSION}-base-${ARCH_ALT}.tar.gz"
    tar -xzf /tmp/ubuntu-rootfs.tar.gz -C $ROOTFS_DIR
fi

# B∆∞·ªõc 2: T·∫£i proot n·∫øu ch∆∞a c√≥
if [ ! -f "$ROOTFS_DIR/usr/local/bin/proot" ]; then
    echo "[+] ƒêang t·∫£i proot..."
    curl -Lo "$ROOTFS_DIR/usr/local/bin/proot" "$PROOT_URL"
    chmod +x "$ROOTFS_DIR/usr/local/bin/proot"
fi

# B∆∞·ªõc 3: Thi·∫øt l·∫≠p DNS v√† ƒë√°nh d·∫•u ƒë√£ c√†i
if [ ! -e $ROOTFS_DIR/.installed ]; then
    echo "[+] C·∫•u h√¨nh DNS..."
    echo "nameserver 1.1.1.1" > $ROOTFS_DIR/etc/resolv.conf
    echo "nameserver 1.0.0.1" >> $ROOTFS_DIR/etc/resolv.conf

    rm -rf /tmp/ubuntu-rootfs.tar.gz
    touch $ROOTFS_DIR/.installed
fi

# B∆∞·ªõc 4: In th√¥ng b√°o ch√†o m·ª´ng
clear && cat << "EOF"

‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà    ‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà    ‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà    ‚ñà‚ñà 
‚ñà‚ñà       ‚ñà‚ñà    ‚ñà‚ñà ‚ñà‚ñà    ‚ñà‚ñà ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà 
‚ñà‚ñà‚ñà‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà ‚ñà‚ñà    ‚ñà‚ñà ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà 
‚ñà‚ñà       ‚ñà‚ñà    ‚ñà‚ñà ‚ñà‚ñà    ‚ñà‚ñà ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà    ‚ñà‚ñà 
‚ñà‚ñà        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà     ‚ñà‚ñà     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  

Ch√†o m·ª´ng ƒë·∫øn v·ªõi Ubuntu PRoot!
ƒê√¢y l√† m√¥i tr∆∞·ªùng Ubuntu $UBUNTU_VERSION ch·∫°y kh√¥ng c·∫ßn quy·ªÅn root.

üîß M·ªôt s·ªë l·ªánh b·∫°n c√≥ th·ªÉ d√πng sau khi v√†o m√¥i tr∆∞·ªùng:
    apt update
    apt install nano curl wget sudo python3

EOF

# B∆∞·ªõc 5: Kh·ªüi ch·∫°y Ubuntu trong proot
$ROOTFS_DIR/usr/local/bin/proot \
--rootfs="$ROOTFS_DIR" \
--link2symlink \
--kill-on-exit \
--root-id \
--cwd=/root \
--bind=/proc \
--bind=/dev \
--bind=/sys \
--bind=/tmp \
--bind=/etc/resolv.conf \
/bin/bash
