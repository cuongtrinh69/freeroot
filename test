#!/bin/sh

#############################
# Ubuntu RootFS Installer   #
#############################

ROOTFS_DIR=/home/container
UBUNTU_VERSION="20.04"  # Có thể đổi thành 22.04 hoặc bản mới hơn

ARCH=$(uname -m)
if [ "$ARCH" = "x86_64" ]; then
  ARCH_ALT=amd64
elif [ "$ARCH" = "aarch64" ]; then
  ARCH_ALT=arm64
else
  echo "Unsupported architecture: $ARCH"
  exit 1
fi

if [ ! -e $ROOTFS_DIR/.installed ]; then
    echo "[+] Đang tải Ubuntu rootfs..."
    curl -Lo /tmp/ubuntu-rootfs.tar.gz "http://cdimage.ubuntu.com/ubuntu-base/releases/${UBUNTU_VERSION}/release/ubuntu-base-${UBUNTU_VERSION}-base-${ARCH_ALT}.tar.gz"
    mkdir -p $ROOTFS_DIR
    tar -xzf /tmp/ubuntu-rootfs.tar.gz -C $ROOTFS_DIR
fi

########################
# Cài đặt PRoot Binary #
########################

PROOT_VERSION="5.3.0"
if [ ! -e $ROOTFS_DIR/usr/local/bin/proot ]; then
    echo "[+] Tải PRoot..."
    curl -Lo $ROOTFS_DIR/usr/local/bin/proot "https://github.com/proot-me/proot/releases/download/v${PROOT_VERSION}/proot-v${PROOT_VERSION}-${ARCH}-static"
    chmod 755 $ROOTFS_DIR/usr/local/bin/proot
fi

########################
# Cấu hình cơ bản     #
########################

if [ ! -e $ROOTFS_DIR/.installed ]; then
    echo "nameserver 1.1.1.1" > $ROOTFS_DIR/etc/resolv.conf
    echo "nameserver 1.0.0.1" >> $ROOTFS_DIR/etc/resolv.conf
    touch $ROOTFS_DIR/.installed
    rm -rf /tmp/ubuntu-rootfs.tar.gz
fi

clear && cat << EOF

███████  ██    ██  ██████  ██    ██ ████████ ██    ██ 
██       ██    ██ ██    ██ ██    ██    ██    ██    ██ 
█████    ██    ██ ██    ██ ██    ██    ██    ██    ██ 
██       ██    ██ ██    ██ ██    ██    ██    ██    ██ 
██        ██████   ██████   ██████     ██     ██████  

Chào mừng đến với Ubuntu $UBUNTU_VERSION PRoot môi trường!
Bạn đang chạy trong môi trường không cần root với đầy đủ tính năng Linux.

Một số lệnh hữu ích sau khi vào môi trường:

    apt update
    apt install nano curl sudo wget python3

EOF

###########################
# Bắt đầu môi trường PRoot #
###########################

$ROOTFS_DIR/usr/local/bin/proot \
--rootfs="$ROOTFS_DIR" \
--link2symlink \
--kill-on-exit \
--root-id \
--cwd=/root \
--bind=/proc \
--bind=/dev \
--bind=/sys \
--bind=/tmp \
--bind=/etc/resolv.conf \
/bin/bash
