#!/bin/sh

set -e

ROOTFS_URL="https://partner-images.canonical.com/core/focal/current/ubuntu-focal-core-cloudimg-amd64-root.tar.gz"
ROOTFS_FILE="ubuntu-rootfs.tar.gz"
ROOTFS_DIR="./ubuntu-fs"

echo "[+] Đang tải Ubuntu RootFS..."

# Tải RootFS nếu chưa có
if [ ! -f "$ROOTFS_FILE" ]; then
    curl -L -o "$ROOTFS_FILE" "$ROOTFS_URL"
fi

# Giải nén nếu chưa giải nén
if [ ! -d "$ROOTFS_DIR" ]; then
    mkdir -p "$ROOTFS_DIR"
    tar -xzf "$ROOTFS_FILE" -C "$ROOTFS_DIR"
fi

# Kiểm tra proot
if ! command -v proot >/dev/null 2>&1; then
    echo "[!] Lỗi: proot chưa được cài đặt. Vui lòng tải từ https://github.com/proot-me/proot/releases"
    exit 127
fi

echo "[+] Đang khởi động Ubuntu..."

exec proot -0 -r "$ROOTFS_DIR" -b /dev -b /proc -b /sys -w /root /bin/sh
